{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Daily News</title>
    {% include 'header.html' %}
    {% include 'topscript.html' %}
    <script src="{% static 'jquery/jquery.min.js' %}"></script>
</head>
<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">
        {% include 'sidebar.html' %}
        <div id="content-wrapper" class="d-flex flex-column">
            <!-- Main Content -->
            <div id="content">
                {% include 'topbar.html' %}
                <!-- Begin Page Content -->
                <div class="container-fluid">
                    <!-- Content Row -->
                    <div class="container rounded bg-white mt-5 mb-5">
                        <div class="row">
                            <div class="col-md-3 border-right">
                                <div class="d-flex flex-column align-items-center text-center p-3 py-5"><img class="rounded-circle mt-5" width="150px" src="https://st3.depositphotos.com/15648834/17930/v/600/depositphotos_179308454-stock-illustration-unknown-person-silhouette-glasses-profile.jpg">
                                    <span class="font-weight-bold">{{user_data.User_Id}}</span>
                                    <span class="text-black-50">{{user_data.User_Name}}</span>
                                    <span class="text-black-50" style="font-size: smaller;">최초 접속 : {{user_data.User_CreateDT}}</span>
                                    <span class="text-black-50" style="font-size: smaller;">최근 접속 : {{user_data.User_RecentDT}}</span>
                                    <span> </span>
                                </div>
                            </div>
                            <div class="col-md-5 border-right">
                                <div class="p-3 py-5">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h4 class="text-right">프로필 확인</h4>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-12"><label class="labels">이름</label><input type="text" id="userName" class="form-control" placeholder="이름 입력" value="{{user_data.User_Name}}"></div>
                                        <div class="col-md-12"><label class="labels">휴대전화</label><input type="text" id="userMobileNumber" class="form-control" placeholder="휴대전화 입력" value="{{user_data.User_MobileNumber}}"></div>
                                        <div class="col-md-12"><label class="labels">이메일</label><input type="text" id="userEmail" class="form-control" placeholder="이메일 입력" value="{{user_data.User_Email}}"></div>
                                        <div class="col-md-12"><label class="labels">관심단어</label><input type="text" id="userFocusWord" class="form-control" placeholder="관심 키워드 입력" value="{{user_data.User_Focus_word}}"></div>
                                        <div class="col-md-12">
                                            <label class="labels">관심 뉴스</label>
                                            <select class="form-control" aria-label="Default select example" id="userFocusCompany">
                                                {% for company in company_data %}
                                                {% if company.News_Company_Name == user_data.User_Focus_Company%}
                                                <option selected value="{{company.News_Company_Name}}">{{company.News_Company_Name}}</option>
                                                {% else %}
                                                <option value="{{company.News_Company_Name}}">{{company.News_Company_Name}}</option>
                                                {% endif %}
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mt-5 text-center"><button id="btnUpdate" class="btn btn-primary profile-button" type="button">Save Profile</button></div>
                                    <script>
                                        $('#btnUpdate').on('click', function(e) {
                                            if($('#userName').val() == "" ){
                                                alert('이름을 입력하세요');
                                                $('#userName').focus();
                                                return;
                                            }else if($('#userName').val().length > 50 ){
                                                alert('이름이 너무 깁니다.')
                                                $('#userName').focus();
                                                return;
                                            }else if($('#userMobileNumber').val().length > 50 ){
                                                alert('핸드폰 번호가 너무 깁니다.')
                                                $('#userMobileNumber').focus();
                                                return;
                                            }else if($('#userEmail').val().length > 50 ){
                                                alert('이메일이 너무 깁니다.')
                                                $('#userEmail').focus();
                                                return;
                                            }else if($('#userFocusWord').val().length > 50 ){
                                                alert('관심 키워드 명이 너무 깁니다.')
                                                $('#userFocusWord').focus();
                                                return;
                                            }else if($('#currentPassword').val() !== $('#currentPasswordRepeat').val() ){
                                                alert('비밀번호 재입력이 서로 다릅니다')
                                                $('#registerPassword').focus();
                                                return;
                                            }else{
                                                var data={
                                                    userName:$('#userName').val(),
                                                    userMobileNumber:$('#userMobileNumber').val(),
                                                    userEmail:$('#userEmail').val(),
                                                    userFocusWord:$('#userFocusWord').val(),
                                                    userFocusCompany:$('#userFocusCompany option:selected').val(),
                                                    currentPassword:$('#currentPassword').val(),
                                            }
                                            $.ajax({
                                                type:'POST',
                                                url:"/requestProfile",
                                                dataType: "text",
                                                contentType:'application/json; charset=utf-8',
                                                data:JSON.stringify(data),
                                                success : function(data){
                                                    console.log(data);
                                                    if(data === "FALSE"){
                                                        console.log("비밀번호 확인 필요");
                                                    }else{
                                                        console.log("개인정보 변경 완료");
                                                        location.reload();
                                                    }
                                                },
                                                error : function(error){
                                                    console.log("개인정보 변경 오류");
                                                    console.log(JSON.stringify(error));
                                                }
                                            })
                                            }
                                        });
                                    </script>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-3 py-5">
                                    <div class="d-flex justify-content-between align-items-center experience"><span>본인 확인</span></div><br>
                                    <div class="col-md-12"><label class="labels">현재 비밀번호</label><input type="password" id="currentPassword" class="form-control" placeholder="현재 비밀번호 입력" value=""></div> <br>
                                    <div class="col-md-12"><label class="labels">현재 비밀번호 확인</label><input type="password" id="currentPasswordRepeat" class="form-control" placeholder="현재 비밀번호 재입력" value=""></div>
                                    <div class="mt-5 text-center"><button id="btnDelete" data-toggle="modal" data-target="#changePasswordModal" class="btn btn-primary profile-button" type="button">비밀번호 바꾸기</button></div>
                                    <div class="mt-1 text-center"><button id="btnDelete" data-toggle="modal" data-target="#deleteModal" class="btn btn-Danger profile-button" type="button">계정 삭제하기</button></div>
                                </div>
                            </div>
                        </div>
                    </div>
                <!-- /.container-fluid -->
            </div>
            <!-- delete Modal-->
            <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">계정 삭제 확인</h5>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">삭제하시겠습니까?</div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" type="button" data-dismiss="modal">취소</button>
                        <button class="btn btn-Danger" type="button" id="btnConfirmDelete">삭제</button>
                        <script>
                            $('#btnConfirmDelete').on('click', function(e) {
                             $.ajax({
                                 type:'POST',
                                 url:"/deleteProfile",
                                 dataType: "text",
                                 contentType:'application/json; charset=utf-8',
                                 success : function(data){
                                    console.log("삭제 완료");
                                    location.href = '/';
                                 },
                                 error : function(error){
                                    console.log("삭제 오류");
                                    console.log(JSON.stringify(error));
                                 }
                             })
                            });
                        </script>
                    </div>
                </div>
            </div>
            </div>
            <!-- password change Modal-->
            <div class="modal fade" id="changePasswordModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">비밀번호 변경</h5>
                            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div class="modal-body">비밀번호를 변경하시겠습니까?<br>
                            <div class="col-md-12"><label class="labels">현재 비밀번호</label><input type="text" id="updateCurrentPassword" class="form-control" placeholder="현재 비밀번호" value=""></div> <br>
                            <div class="col-md-12"><label class="labels">현재 비밀번호 재입력</label><input type="text" id="updateCurrentPasswordRepeat" class="form-control" placeholder="현재 비밀번호 재입력" value=""></div><br>
                            <div class="col-md-12"><label class="labels">신규 비밀번호</label><input type="text" id="updateNewPassword" class="form-control" placeholder="신규 비밀번호 입력" value=""></div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" type="button" data-dismiss="modal">취소</button>
                            <button class="btn btn-Danger" type="button" id="btnConfirmPasswordChange">변경</button>
                            <script>
                                $('#btnConfirmPasswordChange').on('click', function(e) {
                                    if($('#updateCurrentPassword').val() !== $('#updateCurrentPasswordRepeat').val()){
                                        alert('비밀번호 재입력이 서로 다릅니다.')
                                        $('#registerPassword').focus();
                                        return;
                                    }else if($('#updateNewPassword').val() == "" ){
                                        alert('신규 패스워드를 입력하세요')
                                        $('#updateNewPassword').focus();
                                        return;
                                    }else if($('#updateNewPassword').val().length > 50 ){
                                        alert('신규 패스워드의 길이가 너무 깁니다.')
                                        $('#updateNewPassword').focus();
                                        return;
                                    }else{
                                        var data={
                                            currentPassword:$('#updateCurrentPassword').val(),
                                            updatePassword:$('#updateNewPassword').val(),
                                        }
                                        $.ajax({
                                            type:'POST',
                                            url:"/requestPasswordChange",
                                            dataType: "text",
                                            contentType:'application/json; charset=utf-8',
                                            data:JSON.stringify(data),
                                            success : function(data){
                                                console.log(data);
                                                if(data === "FALSE"){
                                                    console.log("비밀번호를 확인하세요");
                                                }else{
                                                    console.log("비밀번호가 변경되었습니다. 다시 로그인해주세요.");
                                                    location.href = "/";
                                                }
                                            },
                                            error : function(error){
                                                console.log("변경 오류");
                                                console.log(JSON.stringify(error));
                                            }
                                        })
                                    }
                                });
                            </script>
                        </div>
                    </div>
                </div>
                </div>
            {% include 'footer.html' %}
        </div>
    </div>
    {% include 'logout.html' %}
    {% include 'script.html' %}
</body>
</html>